# ðŸ”´ PROBLÃˆME BACKEND FASTAPI - ENDPOINTS MANQUANTS

## Contexte
Mon frontend React (VintedBot Studio) envoie des requÃªtes Ã  ton backend FastAPI hÃ©bergÃ© sur Replit, mais plusieurs endpoints critiques ne fonctionnent pas ou timeout.

## ðŸš¨ Erreur principale : `/vinted/publish/queue`

**URL testÃ©e :**
GET https://b3358a26-d290-4c55-82fc-cc0ad63fac5b-00-29ghky26cw3zi.janeway.replit.dev/vinted/publish/queue


**Comportement actuel :**
- Timeout aprÃ¨s 10 secondes (AbortError)
- Le frontend charge des donnÃ©es mockÃ©es en fallback

**Headers envoyÃ©s :**
Content-Type: application/json


**RÃ©ponse attendue (JSON) :**
```json
[
  {
    "job_id": "job-123",
    "item_id": 456,
    "status": "queued",  // ou "processing" | "success" | "failed" | "blocked"
    "mode": "manual",    // ou "automated"
    "scheduled_at": "2025-10-14T12:00:00Z",  // ISO 8601 (optionnel)
    "logs": "Logs du job...",                 // optionnel
    "screenshot": "/screenshots/job-123.png" // optionnel
  }
]
ðŸ“‹ Autres endpoints potentiellement manquants
1. Upload photos multi-fichiers
POST /vinted/photos/upload
Content-Type: multipart/form-data

FormData :
  files: File[]  // ATTENTION : champ "files" au pluriel, pas "file"
  
RÃ©ponse attendue :
{
  "photos": [
    { "temp_id": "abc", "url": "https://...", "filename": "image1.jpg" },
    { "temp_id": "def", "url": "https://...", "filename": "image2.jpg" }
  ]
}
2. Jobs individuels
GET /vinted/publish/queue/{job_id}
POST /vinted/publish/queue/{job_id}/cancel
POST /vinted/publish/queue/{job_id}/retry
POST /vinted/publish/queue/{job_id}/run
POST /vinted/publish/queue/{job_id}/pause
DELETE /vinted/publish/queue/{job_id}
3. Listings
GET /listings?search=&status=&page=1
POST /listings
PATCH /listings/{id}
DELETE /listings/{id}
POST /listings/publish/{id}
4. Messages Vinted
GET /vinted/messages
GET /vinted/messages/{thread_id}
POST /vinted/messages/{thread_id}/reply
âœ… Ce qui semble dÃ©jÃ  fonctionner
GET /health â†’ 200 OK
GET /ready â†’ 200 OK
POST /ingest/upload â†’ (Ã  vÃ©rifier mais utilisÃ© comme fallback)
ðŸŽ¯ Ce que je veux que tu fasses
ImplÃ©mente l'endpoint /vinted/publish/queue (GET) en prioritÃ© absolue

Retourne un tableau JSON (mÃªme vide [] si pas de jobs)
Respecte le format TypeScript ci-dessus
RÃ©ponds en < 2 secondes (Ã©vite les timeouts)
VÃ©rifie CORS

Le frontend tourne sur https://c6c2806b-8062-4242-8b4d-9a652e04d393.lovableproject.com
Autorise Access-Control-Allow-Origin: * ou ce domaine spÃ©cifique
Headers autorisÃ©s : Content-Type, Authorization
Upload multi-fichiers /vinted/photos/upload

Accepte FormData avec files: File[] (pluriel)
GÃ¨re plusieurs fichiers en une seule requÃªte
Retourne { photos: [...] }
Logs et debugging

Ajoute des print() ou logs pour voir les requÃªtes entrantes
Log les erreurs avec traceback complet
Bonnes pratiques FastAPI

Utilise Pydantic models pour valider les rÃ©ponses (type safety)
Ajoute des status codes HTTP appropriÃ©s (200, 201, 400, 404, 500)
GÃ¨re les exceptions avec HTTPException
Documente les endpoints avec docstrings (apparaÃ®tront dans /docs)
ðŸ§ª Tests Ã  faire aprÃ¨s implÃ©mentation

# Test 1 : Queue
curl -X GET https://ton-backend.replit.dev/vinted/publish/queue

# Test 2 : Upload (avec un fichier test)
curl -X POST https://ton-backend.replit.dev/vinted/photos/upload \
  -F "files=@test1.jpg" \
  -F "files=@test2.jpg"
ðŸ”§ Structure FastAPI recommandÃ©e

from fastapi import FastAPI, File, UploadFile, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel
from typing import List, Optional

app = FastAPI()

# CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # Ã€ sÃ©curiser en prod
    allow_methods=["*"],
    allow_headers=["*"],
)

# Models
class PublishJob(BaseModel):
    job_id: str
    item_id: int | str
    status: str  # "queued" | "processing" | "success" | "failed"
    mode: str    # "manual" | "automated"
    scheduled_at: Optional[str] = None
    logs: Optional[str] = None
    screenshot: Optional[str] = None

# Endpoint principal
@app.get("/vinted/publish/queue", response_model=List[PublishJob])
async def get_publish_queue():
    # TODO : rÃ©cupÃ©rer depuis ta DB/Redis
    # Pour l'instant, retourne un exemple
    return [
        {
            "job_id": "job-demo",
            "item_id": 1,
            "status": "queued",
            "mode": "manual",
            "scheduled_at": "2025-10-14T14:00:00Z"
        }
    ]

@app.post("/vinted/photos/upload")
async def upload_photos(files: List[UploadFile] = File(...)):
    photos = []
    for file in files:
        # TODO : sauvegarder le fichier
        photos.append({
            "temp_id": f"tmp-{file.filename}",
            "url": f"https://storage.example.com/{file.filename}",
            "filename": file.filename
        })
    return {"photos": photos}
ðŸ“Š PrioritÃ©s
â­ï¸â­ï¸â­ï¸ /vinted/publish/queue (GET) - CRITIQUE
â­ï¸â­ï¸ /vinted/photos/upload (POST multi-files)
â­ï¸ Actions jobs (cancel, retry, pause, delete)
Messages & Listings endpoints
