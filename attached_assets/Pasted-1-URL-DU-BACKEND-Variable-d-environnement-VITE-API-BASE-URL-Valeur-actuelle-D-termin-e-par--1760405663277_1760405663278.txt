1. URL DU BACKEND
Variable d'environnement : VITE_API_BASE_URL

Valeur actuelle : D√©termin√©e par getApiBase() dans src/lib/api.ts :

Priorit√© 1 : localStorage.getItem('apiBase') (override manuel)
Priorit√© 2 : import.meta.env.VITE_API_BASE_URL
Priorit√© 3 : "https://vintedbot-studio.replit.app" (d√©faut)
2. ENDPOINT D'AUTHENTIFICATION
URL compl√®te : /vinted/auth/session
M√©thode : POST
Headers : Content-Type: application/json

Body EXACT envoy√© :


{
  "cookie_value": "<le cookie complet>",
  "user_agent": "<le user agent>",
  "expires_at": null
}
3. VALIDATION DE LA R√âPONSE
R√©ponse ATTENDUE par le frontend :


{
  "session_id": number,      // OBLIGATOIRE
  "valid": boolean,          // OBLIGATOIRE
  "note"?: string,           // optionnel
  "created_at": string       // OBLIGATOIRE
}
Condition de SUCC√àS (ligne 45 de CookieForm.tsx) :


if (result.session_id && result.valid) {
  // ‚úÖ Session valide
}
Condition d'√âCHEC :


else {
  // ‚ùå "Session invalide"
}
4. V√âRIFICATION POST-SAUVEGARDE
Endpoint : /vinted/auth/check
M√©thode : GET

R√©ponse attendue :


{
  "authenticated": boolean,
  "username"?: string,
  "user_id"?: string
}
Validation :


if (result.authenticated && result.username) {
  // ‚úÖ toast.success(`Connect√© en tant que @${result.username}`)
} else {
  // ‚ùå toast.error("Non authentifi√©")
}
5. CODE SOURCE
Appel API (src/lib/apiClient.ts, lignes 20-28) :


saveSession: (payload: { cookie: string; user_agent: string; expires_at?: string | null }) =>
  api<{ session_id: number; valid: boolean; note?: string; created_at: string }>("/vinted/auth/session", {
    method: "POST",
    body: JSON.stringify({
      cookie_value: payload.cookie,
      user_agent: payload.user_agent,
      expires_at: payload.expires_at
    }),
  }),
Traitement de la r√©ponse (src/components/CookieForm.tsx, lignes 36-58) :


const result = await VintedAPI.saveSession({
  cookie: cookie.trim(),
  user_agent: userAgent.trim(),
  expires_at: null,
});

// Backend returns {session_id, valid, created_at} instead of {ok, persisted}
if (result.session_id && result.valid) {
  toast.success("Session Vinted sauvegard√©e ‚úì", {
    description: `Session ID: ${result.session_id}`
  });
  setIsSaved(true);
  setShowCookie(false);
  setCookie("");
} else {
  console.error("[CookieForm] Session invalide:", result);
  toast.error("Session invalide", {
    description: result.note || "Le backend a rejet√© la session"
  });
}
üî¥ PROBL√àME ACTUEL D√âTECT√â dans les logs :

Ton backend renvoie :


{"ok": true, "persisted": true, "username": "vinted_user"}
Mais le frontend attend :


{"session_id": 123, "valid": true, "created_at": "2025-01-14T01:31:25Z"}
‚û°Ô∏è Ton backend doit renvoyer session_id et valid au lieu de ok et persisted.

Voici les d√©tails EXACTS de l'authentification frontend :

1. URL DU BACKEND
Variable d'environnement : VITE_API_BASE_URL

Valeur actuelle : D√©termin√©e par getApiBase() dans src/lib/api.ts :

Priorit√© 1 : localStorage.getItem('apiBase') (override manuel)
Priorit√© 2 : import.meta.env.VITE_API_BASE_URL
Priorit√© 3 : "https://vintedbot-studio.replit.app" (d√©faut)
2. ENDPOINT D'AUTHENTIFICATION
URL compl√®te : /vinted/auth/session
M√©thode : POST
Headers : Content-Type: application/json

Body EXACT envoy√© :


{
  "cookie_value": "<le cookie complet>",
  "user_agent": "<le user agent>",
  "expires_at": null
}
3. VALIDATION DE LA R√âPONSE
R√©ponse ATTENDUE par le frontend :


{
  "session_id": number,      // OBLIGATOIRE
  "valid": boolean,          // OBLIGATOIRE
  "note"?: string,           // optionnel
  "created_at": string       // OBLIGATOIRE
}
Condition de SUCC√àS (ligne 45 de CookieForm.tsx) :


if (result.session_id && result.valid) {
  // ‚úÖ Session valide
}
Condition d'√âCHEC :


else {
  // ‚ùå "Session invalide"
}
4. V√âRIFICATION POST-SAUVEGARDE
Endpoint : /vinted/auth/check
M√©thode : GET

R√©ponse attendue :


{
  "authenticated": boolean,
  "username"?: string,
  "user_id"?: string
}
Validation :


if (result.authenticated && result.username) {
  // ‚úÖ toast.success(`Connect√© en tant que @${result.username}`)
} else {
  // ‚ùå toast.error("Non authentifi√©")
}
5. CODE SOURCE
Appel API (src/lib/apiClient.ts, lignes 20-28) :


saveSession: (payload: { cookie: string; user_agent: string; expires_at?: string | null }) =>
  api<{ session_id: number; valid: boolean; note?: string; created_at: string }>("/vinted/auth/session", {
    method: "POST",
    body: JSON.stringify({
      cookie_value: payload.cookie,
      user_agent: payload.user_agent,
      expires_at: payload.expires_at
    }),
  }),
Traitement de la r√©ponse (src/components/CookieForm.tsx, lignes 36-58) :


const result = await VintedAPI.saveSession({
  cookie: cookie.trim(),
  user_agent: userAgent.trim(),
  expires_at: null,
});

// Backend returns {session_id, valid, created_at} instead of {ok, persisted}
if (result.session_id && result.valid) {
  toast.success("Session Vinted sauvegard√©e ‚úì", {
    description: `Session ID: ${result.session_id}`
  });
  setIsSaved(true);
  setShowCookie(false);
  setCookie("");
} else {
  console.error("[CookieForm] Session invalide:", result);
  toast.error("Session invalide", {
    description: result.note || "Le backend a rejet√© la session"
  });
}
üî¥ PROBL√àME ACTUEL D√âTECT√â dans les logs :

Ton backend renvoie :


{"ok": true, "persisted": true, "username": "vinted_user"}
Mais le frontend attend :


{"session_id": 123, "valid": true, "created_at": "2025-01-14T01:31:25Z"}
‚û°Ô∏è Ton backend doit renvoyer session_id et valid au lieu de ok et persisted.