üéØ Objectif :

Pr√©pare mon VintedBot Solo Pro (FastAPI) pour une int√©gration compl√®te avec un frontend Lovable.dev.
Le but est que le frontend puisse consommer directement toutes les routes (ingest, listings, stats, etc.) sans modification c√¥t√© client.

Je veux que le backend soit :

Stable ‚úÖ

CORS-compatible ‚úÖ

Auto-document√© ‚úÖ

Structur√© proprement ‚úÖ

Configurable avec .env ‚úÖ

Connectable √† Lovable via VITE_API_BASE_URL ‚úÖ

‚öôÔ∏è T√¢ches √† ex√©cuter
1Ô∏è‚É£ CORS Setup

Active le CORS complet pour les domaines Lovable et locaux :

from fastapi.middleware.cors import CORSMiddleware

origins = [
    "http://localhost",
    "http://localhost:3000",
    "http://127.0.0.1:3000",
    "http://localhost:5173",
    "http://127.0.0.1:5173",
    "https://*.lovable.dev",
    "https://*.lovable.app",
]

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_methods=["*"],
    allow_headers=["*"],
)


Assure-toi que tous les endpoints /ingest, /listings, /stats, /health renvoient du JSON valide.

2Ô∏è‚É£ .env / configuration propre

Cr√©e un fichier .env.example :

OPENAI_API_KEY=
PRICE_DROP_CRON=0 3 * * *
ALLOWED_ORIGINS=https://*.lovable.dev,https://*.lovable.app,http://localhost:3000


Charge ces variables dans app.py :

from dotenv import load_dotenv
load_dotenv()


Lis ALLOWED_ORIGINS pour configurer origins dynamiquement :

import os
origins = os.getenv("ALLOWED_ORIGINS", "").split(",")

3Ô∏è‚É£ Uniformise toutes les r√©ponses API

Chaque endpoint doit renvoyer des JSON standardis√©s avec les m√™mes cl√©s.
Ajoute une fonction helper :

from fastapi.responses import JSONResponse

def ok(data: dict | list, status_code: int = 200):
    return JSONResponse(content=data, status_code=status_code)


Et utilise-la partout (return ok({...})).

4Ô∏è‚É£ Health & Meta

Ajoute dans routes/stats.py :

@router.get("/health")
def get_health():
    return {
        "status": "healthy",
        "uptime_seconds": round(time.time() - START_TIME, 2),
        "version": "1.0.0",
        "scheduler_jobs": len(scheduler.get_jobs()) if scheduler else 0
    }

5Ô∏è‚É£ V√©rifie les endpoints Lovable-friendly

Tous doivent exister :

Endpoint	M√©thode	Description
/ingest/photos	POST	Cr√©e un draft √† partir d‚ÄôURL(s)
/listings/all	GET	Retourne tout le stock
/listings/{id}	GET	Retourne un item
/listings/publish/{id}	POST	Marque comme publi√© (mock)
/listings/delete/{id}	DELETE	Supprime un item
/stats	GET	Retourne les KPIs
/export/csv	GET	T√©l√©charge un CSV
/health	GET	Status du backend
6Ô∏è‚É£ Test d‚Äôint√©gration Lovable

Ajoute un fichier test_lovable.py :

import requests

BASE = "https://python-yourbot.replit.app"

def test_health():
    r = requests.get(f"{BASE}/health")
    assert r.status_code == 200

def test_ingest():
    r = requests.post(f"{BASE}/ingest/photos", json={"photo_urls": ["https://picsum.photos/seed/1/800/800"]})
    assert r.status_code == 200
    print(r.json())


‚û°Ô∏è Permet de valider que Lovable aura les bons formats et que tout renvoie du JSON correct.

7Ô∏è‚É£ Expose le port Replit

Assure-toi que Replit lance le serveur avec :

uvicorn backend.app:app --host 0.0.0.0 --port 8000


(Port 8000 doit √™tre visible dans ‚ÄúWebview‚Äù).

8Ô∏è‚É£ Indique les variables d‚Äôenvironnement c√¥t√© Lovable

Le frontend pourra ensuite appeler :

const API_BASE = import.meta.env.VITE_API_BASE_URL
fetch(`${API_BASE}/ingest/photos`, { method:"POST", ... })

9Ô∏è‚É£ √âcris un guide lovable_integration.md

G√©n√®re automatiquement ce fichier :

# Lovable Integration Guide

## Base URL
Define in Lovable Env:


VITE_API_BASE_URL=https://python-yourbot.replit.app


## Key Endpoints
| Endpoint | Method | Description |
|-----------|--------|-------------|
| /ingest/photos | POST | Create draft from photo URLs |
| /listings/all | GET | All listings |
| /listings/{id} | GET | Item detail |
| /listings/publish/{id} | POST | Mock publish |
| /stats | GET | Inventory statistics |
| /health | GET | System status |
| /export/csv | GET | Export CSV |

‚úÖ Ready for frontend Lovable connection!

üîí 10Ô∏è‚É£ Test final √† ex√©cuter

Demande √† Replit de s‚Äôassurer que :

/docs fonctionne

GET /health ‚Üí {"status": "healthy"}

POST /ingest/photos retourne un vrai draft JSON

GET /stats retourne les KPI cl√©s

Toutes les routes renvoient CORS headers :
access-control-allow-origin: * ou ton domaine Lovable.

‚ú® R√©sum√© final pour Replit

Transforme mon backend FastAPI existant en une version Lovable-ready, avec :

CORS complet pour Lovable et localhost

Endpoints propres et uniformes

.env clair et charg√© dynamiquement

/health, /stats, /ingest, /listings, /export tous pr√™ts

Documentation lovable_integration.md

Port 8000 expos√© publiquement

Le but : que mon front Lovable puisse se connecter sans aucun bug CORS ni format incoh√©rent.
Toutes les r√©ponses doivent √™tre du JSON clair, bien format√©, et testable via Swagger /docs.

üí° Option bonus √† demander √† Replit √† la fin :

‚ÄúAdd automatic OpenAPI client generator in /frontend/openapi_client/ so I can import it directly into Lovable later.‚Äù